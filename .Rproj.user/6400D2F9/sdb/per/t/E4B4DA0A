{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Pre-trial jail inmates in Connecticut\"\nauthor: \"Andrew Ba Tran\"\ndate: \"July 18, 2016\"\noutput: html_document\n---\n\nThis is the methodology used for the [Trend CT](http://www.trendct.org) story: [Who’s sitting in pretrial detention in Connecticut](http://trendct.org/2016/07/20/pre-trial-inmates/). These are exploratory tables and charts— some of which I did not include in the final story for various reasons.\n\nVisit the [repo](https://github.com/trendct/data/tree/master/2016/07/pre-trial-inmates-ct) for the [data](https://github.com/trendct/data/tree/master/2016/07/pre-trial-inmates-ct/data) used in this analysis. (Also, check out the reproducible scripts and data behind many of our other stories in our [central repo](https://github.com/trendct/data))\n\nData for this analysis was provided by Department of Corrections via the  [Connecticut Open Data Portal](https://data.ct.gov/Public-Safety/Accused-Pre-Trial-Inmates-in-Correctional-Faciltie/b674-jy6w?category=Public-Safety), which is updated nightly.\n\n**What’s in this walkthrough**\n\nSeveral visualizations and tables exploring the data\n\n```{r libraries, warning=F, message=F}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(lubridate)\nlibrary(knitr)\nlibrary(ggalt)\nlibrary(extrafont)\nlibrary(grid)\nlibrary(gridExtra)\nlibrary(stringr)\nlibrary(DT)\n```\n\n```{r data_ingesting, warning=FALSE}\nupdate <- read.csv(\"https://data.ct.gov/api/views/b674-jy6w/rows.csv\")\n```\n\n\n```{r race_date_total, fig.width=9, fig.height=6}\n# by date, race total\nrace_total_date <- update %>%\n  group_by(DOWNLOAD.DATE, RACE) %>%\n  summarise(total=n()) %>%\n  filter(RACE==\"BLACK\" | RACE==\"HISPANIC\" | RACE==\"WHITE\")\n\nrace_total_date$DOWNLOAD.DATE <- mdy(race_total_date$DOWNLOAD.DATE)\n\ngg <- ggplot(race_total_date, aes(x=DOWNLOAD.DATE, y=total, group=RACE, color=RACE)) + geom_line()\ngg <- gg + labs(x=NULL, y=\"Inmates\", title=paste(\"Accused pre-trial inmates in Connecticut jails\"),\n                caption=\"SOURCE: Department of Corrections\\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Calibri\")\n#gg <- gg + theme(panel.grid.major=element_blank())\n#gg <- gg + theme(panel.grid.minor=element_blank())\ngg <- gg + theme(panel.border=element_blank())\ngg <- gg + theme(text = element_text(size=10))\n#gg <- gg + theme(axis.ticks=element_blank())\n#gg <- gg + theme(axis.text.x=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Black\", size=22))\ngg <- gg + theme(plot.subtitle=element_text(face=\"italic\", size=9, margin=margin(b=12)))\ngg <- gg + theme(plot.caption=element_text(size=12, margin=margin(t=10, r=80), color=\"#7a7d7e\"))\ngg <- gg + geom_label(data=race_total_date, aes(x=ymd(\"2016-7-19\"), y=1336, label=\"Black (1,336)\", hjust=0),\n                      family=\"Helvetica\", lineheight=0.95,\n                      size=4.5, label.size=0, color=\"black\")\ngg <- gg + geom_label(data=race_total_date, aes(x=ymd(\"2016-7-19\"), y=849, label=\"Hispanic (849)\", hjust=0),\n                      family=\"Helvetica\", lineheight=0.95,\n                      size=4.5, label.size=0, color=\"black\")\ngg <- gg + geom_label(data=race_total_date, aes(x=ymd(\"2016-7-19\"), y=1126, label=\"White (1,126)\", hjust=0),\n                      family=\"Helvetica\", lineheight=0.95,\n                      size=4.5, label.size=0, color=\"black\")\ngg <- gg + theme(legend.position=\"none\")\ngg <- gg + theme(plot.margin = unit(c(1, 5, 1, 1), \"lines\"))\ngg\n\ngb <- ggplot_build(gg)\ngt <- ggplot_gtable(gb)\n\ngt$layout$clip[gt$layout$name==\"panel\"] <- \"off\"\ngrid.draw(gt)\nggsave(gt, file = \"race_totals_time.png\", width = 8, height = 6, type = \"cairo-png\")\n\nrace_total_date$RACE <- gsub(\" \", \".\", race_total_date$RACE)\n\nrace_total_date <- update %>%\n  group_by(DOWNLOAD.DATE, RACE) %>%\n  summarise(total=n()) %>%\n  spread(RACE, total) %>%\n  mutate(total = `AMER IND` + ASIAN + BLACK + HISPANIC + WHITE) %>%\n  mutate(American.Indian.per = round(`AMER IND`/total*100,2), Asian.per = round(ASIAN/total*100,2), Black.per = round(BLACK/total*100,2), Hispanic.per = round(HISPANIC/total*100,2), White.per = round(WHITE/total*100,2)) %>%\n  select(DOWNLOAD.DATE, American.Indian.per, Asian.per, Black.per, Hispanic.per, White.per) %>%\n  gather(Race, Percent, 2:6)\n\nrace_total_date$Race <- gsub(\".per\", \"\", race_total_date$Race)\n\ngg <- ggplot(race_total_date, aes(x=mdy(DOWNLOAD.DATE), y=Percent)) + geom_bar(stat=\"identity\") + facet_grid(.~Race)\ngg <- gg + labs(x=NULL, y=\"Percent\", title=paste(\"Racial makeup of accused pre-trial inmates\"),\n                caption=\"SOURCE: Department of Corrections\\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Calibri\")\ngg <- gg + theme(text = element_text(size=16))\n#gg <- gg + theme(panel.grid.major=element_blank())\n#gg <- gg + theme(panel.grid.minor=element_blank())\ngg <- gg + theme(panel.border=element_blank())\n#gg <- gg + theme(axis.ticks=element_blank())\n#gg <- gg + theme(axis.text.x=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Black\", size=22))\ngg <- gg + theme(plot.subtitle=element_text(face=\"italic\", size=9, margin=margin(b=12)))\ngg <- gg + theme(plot.caption=element_text(size=12, margin=margin(t=10, r=80), color=\"#7a7d7e\"))\ngg <- gg + theme(plot.margin = unit(c(1, 1, 1, 1), \"lines\"))\n\ngg\nggsave(gg, file = \"race_percent_time.png\", width = 8, height = 6, type = \"cairo-png\")\n\n```\n\n```{r gender}\nfemale_total <- update %>%\n  group_by(DOWNLOAD.DATE, GENDER) %>%\n  summarise(total=n()) %>%\n  spread(GENDER, total) \n\navg_females <- round(mean(female_total$F),0)\navg_males <- round(mean(female_total$M),0)\n\n#round(avg_females/(avg_females+avg_males)*100)\n\nmedian_females <- round(median(female_total$F),0)\nmedian_males <- round(median(female_total$M),0)\n```\n\n### Men and women in jail awaiting trial\n\n**Average number of women:** `r avg_females`\n\n**Average number of men:** `r avg_males`\n\n**Median number of women:** `r median_females`\n\n**Median number of men:** `r median_males`\n\n```{r females_race, fig.width=9, fig.height=6}\nfemale_total <- update %>%\n  filter(GENDER==\"F\") %>%\n  group_by(DOWNLOAD.DATE, RACE) %>%\n  summarise(total=n()) %>%\n  group_by(RACE) %>%\n  summarise(avg=mean(total))\n\ngg <- ggplot(female_total, aes(x=RACE, y=avg)) + geom_bar(stat=\"identity\") \ngg <- gg + labs(x=NULL, y=\"Average\", title=paste(\"Racial makeup of female accused pre-trial inmates\"),\n                caption=\"SOURCE: Department of Correction\\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Calibri\")\ngg <- gg + theme(text = element_text(size=16))\n#gg <- gg + theme(panel.grid.major=element_blank())\n#gg <- gg + theme(panel.grid.minor=element_blank())\ngg <- gg + theme(panel.border=element_blank())\n#gg <- gg + theme(axis.ticks=element_blank())\n#gg <- gg + theme(axis.text.x=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Black\", size=22))\ngg <- gg + theme(plot.subtitle=element_text(face=\"italic\", size=9, margin=margin(b=12)))\ngg <- gg + theme(plot.caption=element_text(size=12, margin=margin(t=10, r=80), color=\"#7a7d7e\"))\ngg <- gg + theme(plot.margin = unit(c(1, 1, 1, 1), \"lines\"))\n\ngg\n```\n\n```{r males_race, fig.height=6, fig.width=9}\nmale_total <- update %>%\n  filter(GENDER==\"M\") %>%\n  group_by(DOWNLOAD.DATE, RACE) %>%\n  summarise(total=n()) %>%\n  group_by(RACE) %>%\n  summarise(avg=mean(total))\n\ngg <- ggplot(male_total, aes(x=RACE, y=avg)) + geom_bar(stat=\"identity\") \ngg <- gg + labs(x=NULL, y=\"Average\", title=paste(\"Racial makeup of male accused pre-trial inmates\"),\n                caption=\"SOURCE: Department of Correction\\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Calibri\")\ngg <- gg + theme(text = element_text(size=16))\n#gg <- gg + theme(panel.grid.major=element_blank())\n#gg <- gg + theme(panel.grid.minor=element_blank())\ngg <- gg + theme(panel.border=element_blank())\n#gg <- gg + theme(axis.ticks=element_blank())\n#gg <- gg + theme(axis.text.x=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Black\", size=22))\ngg <- gg + theme(plot.subtitle=element_text(face=\"italic\", size=9, margin=margin(b=12)))\ngg <- gg + theme(plot.caption=element_text(size=12, margin=margin(t=10, r=80), color=\"#7a7d7e\"))\ngg <- gg + theme(plot.margin = unit(c(1, 1, 1, 1), \"lines\"))\n\ngg\n```\n\n```{r avg_age}\n\navg_age <- update %>%\n  group_by(RACE) %>%\n  summarise(avg_age=round(mean(AGE),0), median_age=round(median(AGE),0))\n```\n\n### Average age by race\n\n```{r avg_table}\nkable(avg_age)\n```\n\n```{r facilities_total}\nfacilities <- update %>%\n  group_by(DOWNLOAD.DATE, FACILITY) %>%\n  summarise(total=n()) %>%\n  group_by(FACILITY) %>%\n  summarise(average=round(mean(total),0), median=round(median(total),0)) %>%\n  arrange(-average)\n```\n\n### Average number of inmates by facility\n\n```{r facilities_table}\nkable(facilities)\n```\n\n```{r bonds_race}\n# Bond amount total by race\n\nbonds <- update %>%\n  group_by(RACE) %>%\n  summarise(avg_bond=mean(BOND.AMOUNT), median_bond=median(BOND.AMOUNT))\n```\n\n### Bond amount by race\n\n```{r bonds_table}\nkable(bonds)\n```\n\n```{r female_offense_list}\nupdate$offense_pre <- gsub(\", .*\", \"\", update$OFFENSE)\nupdate$offense_degree <- gsub(\".*, \", \"\", update$OFFENSE)\n\nupdate$offense_degree <- ifelse(update$offense_pre==update$offense_degree, \"\", update$offense_degree)\n\nfem_offense_list <- update %>%\n  filter(GENDER==\"F\") %>%\n  group_by(DOWNLOAD.DATE, offense_pre) %>%\n  summarise(count=n()) %>%\n  group_by(offense_pre) %>%\n  summarise(avg=round(mean(count),0)) %>%\n  arrange(-avg) \n```\n\n## Female offense list\n\n```{r fem_of_table}\ndatatable(fem_offense_list)\n```\n\n```{r male_offense_list}\nmal_offense_list <- update %>%\n  filter(GENDER==\"M\") %>%\n  group_by(DOWNLOAD.DATE, offense_pre) %>%\n  summarise(count=n()) %>%\n  group_by(offense_pre) %>%\n  summarise(avg=round(mean(count),0)) %>%\n  arrange(-avg) \n```\n\n## Male offense list\n\n```{r male_of_table}\ndatatable(mal_offense_list)\n```\n\n```{r male_offense_race}\n\nmal_offense_race <- update %>%\n  filter(GENDER==\"M\") %>%\n  group_by(DOWNLOAD.DATE, offense_pre, RACE) %>%\n  summarise(count=n()) %>%\n  spread(RACE, count) %>%\n  group_by(offense_pre) %>%\n  summarise(amer.ind.avg=round(mean(`AMER IND`),0), asian.avg=round(mean(ASIAN),0), black.avg=round(mean(BLACK),0), hispanic.avg=round(mean(HISPANIC),0), white.avg=round(mean(WHITE),0)) %>%\n  arrange(-white.avg) \n```\n\n## Male offense list by race\n\n```{r mor_table}\ndatatable(mal_offense_race)\n```\n\n```{r female_offense_race}\n\nfem_offense_race <- update %>%\n  filter(GENDER==\"F\") %>%\n  group_by(DOWNLOAD.DATE, offense_pre, RACE) %>%\n  summarise(count=n()) %>%\n  spread(RACE, count) %>%\n  group_by(offense_pre) %>%\n  summarise(amer.ind.avg=round(mean(`AMER IND`),0), asian.avg=round(mean(ASIAN),0), black.avg=round(mean(BLACK),0), hispanic.avg=round(mean(HISPANIC),0), white.avg=round(mean(WHITE),0)) %>%\n  arrange(-white.avg) \n```\n\n## Female offense list by race\n\n```{r fem_table}\ndatatable(fem_offense_race)\n```\n\n```{r percent_offense_table, warning=F, message=F, fig.height=11, fig.width=9}\n\nmal_offense_race_percent <- update %>%\n  filter(GENDER==\"M\") %>%\n  group_by(DOWNLOAD.DATE, offense_pre, RACE) %>%\n  summarise(count=n()) %>%\n  spread(RACE, count) %>%\n  group_by(offense_pre) %>%\n  summarise(amer.ind.avg=round(mean(`AMER IND`),2), asian.avg=round(mean(ASIAN),0), black.avg=round(mean(BLACK),0), hispanic.avg=round(mean(HISPANIC),0), white.avg=round(mean(WHITE),0)) %>%\n  arrange(-white.avg) %>%\n  group_by(offense_pre) %>%\n  mutate(total=sum(amer.ind.avg,asian.avg,black.avg,hispanic.avg,white.avg, na.rm=T)) %>%\n  filter(total>20) %>%\n  arrange(-total) %>%\n  mutate(American.Indian.avg.per = round((amer.ind.avg/total)*100,0), Asian.avg.per = round(asian.avg/total*100,0),\nBlack.avg.per = round(black.avg/total*100,0), Hispanic.avg.per = round(hispanic.avg/total*100,0), White.avg.per = round(white.avg/total*100,0)) %>%\n  select(offense_pre, total, American.Indian.avg.per, Asian.avg.per, Black.avg.per, Hispanic.avg.per, White.avg.per) %>%\n  gather(Race, Percent, 3:7)\n\nmal_offense_race_percent$Race <- gsub(\".avg.per\", \"\", mal_offense_race_percent$Race)\nmal_offense_race_percent$Race <- gsub(\"\\\\.\", \" \", mal_offense_race_percent$Race)\n\n#plotting it\n\nlibrary(plyr)\ncbPalette <- c(\"#999999\", \"#E69F00\", \"#56B4E9\", \"#009E73\", \"#F0E442\", \"#0072B2\", \"#D55E00\", \"#CC79A7\")\n\ncbbPalette <- c(\"#000000\", \"#E69F00\", \"#56B4E9\", \"#009E73\", \"#F0E442\", \"#0072B2\", \"#D55E00\", \"#CC79A7\")\n\nData <- mal_offense_race_percent\nData[is.na(Data)] <- 0\nData <- ddply(Data, .(offense_pre), transform, pos=cumsum(Percent)-(0.5*Percent))\n\n\nData$offense_pre <- gsub(\" AM\", \"\", Data$offense_pre)\nData$offense_pre <- gsub(\" DF\", \"\", Data$offense_pre)\nData$offense_pre <- gsub(\" AF\", \"\", Data$offense_pre)\nData$offense_pre <- gsub(\" CF\", \"\", Data$offense_pre)\nData$offense_pre <- gsub(\"  F\", \"\", Data$offense_pre)\nData$offense_pre <- str_trim(Data$offense_pre)\n\nData[Data == 0] <- NA\nData <- Data[ order(-Data$total), ]\n\nData$offense_pre <- factor(Data$offense_pre, levels = Data$offense_pre[order(Data$total)])\n\ngg <- ggplot(Data, aes(x = offense_pre, y = Percent)) \ngg <- gg + geom_bar(aes(fill = Race), stat=\"identity\") \ngg <- gg + geom_text(aes(label = Percent, y = pos), size = 4) \ngg <- gg + scale_fill_manual(values=cbPalette)\ngg <- gg + coord_flip() \ngg <- gg + geom_rect(data=Data, aes(ymin=102, ymax=114, xmin=-Inf, xmax=Inf), fill=\"#efefe3\")\ngg <- gg + geom_text(data=Data, aes(label=round(total,0), x=offense_pre, y=108), fontface=\"bold\", size=4, family=\"Calibri\")\ngg <- gg + labs(x=NULL, y=\"Percent\", title=\"Offenses that accused pre-trial inmates face by race\",\n                subtitle=\"Percent of race and total facing offenses. Based on rolling average of inmates per day.\",\n                caption=\"Department of Correction\\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Calibri\")\ngg <- gg + theme(panel.grid.major=element_blank())\ngg <- gg + theme(panel.grid.minor=element_blank())\ngg <- gg + theme(panel.border=element_blank())\ngg <- gg + theme(axis.ticks=element_blank())\ngg <- gg + theme(axis.text.x=element_blank())\n#gg <- gg + theme(text = element_text(size=20))\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Black\", size=16))\ngg <- gg + theme(plot.subtitle=element_text(face=\"italic\", size=10,margin=margin(b=12)))\ngg <- gg + theme(plot.caption=element_text(size=10, margin=margin(t=16), color=\"#7a7d7e\"))\ngg\n```\n\n\n```{r bond_avg_race, warning=F, message=F}\ndetach(\"package:plyr\", unload=TRUE)\n\nmal_offense_race_bond <- update %>%\n  filter(GENDER==\"M\") %>%\n  group_by(DOWNLOAD.DATE, OFFENSE, RACE) %>%\n  summarise(total=n(),avg.bond=mean(BOND.AMOUNT)) %>%\n  select(DOWNLOAD.DATE, OFFENSE, total, RACE, avg.bond) %>%\n  spread(RACE, avg.bond) %>%\n  group_by(OFFENSE) %>%\n  summarise(total = sum(total), amer.ind.avg=round(mean(`AMER IND`, na.rm=T),2), asian.avg=round(mean(ASIAN, na.rm=T),0), black.avg=round(mean(BLACK, na.rm=T),0), hispanic.avg=round(mean(HISPANIC, na.rm=T),0), white.avg=round(mean(WHITE, na.rm=T),0)) %>%\n  arrange(-white.avg) %>%\n  filter(total>20)\n\nmal_offense_race_bond$what <- ifelse(((mal_offense_race_bond$white.avg < mal_offense_race_bond$black.avg) & (mal_offense_race_bond$white.avg < mal_offense_race_bond$hispanic.avg)), \"white\", \"minority\")\n\n```\n\n## Bond amount\n\n```{r bond_amount_table}\ndatatable(mal_offense_race_bond)\n```\n\n\n```{r time_in_jail}\n\ndays_list <- unique(update$DOWNLOAD.DATE)\nupdate$auth.date <- mdy(update$DOWNLOAD.DATE)\nupdate$first.date <- ifelse(mdy(update$LATEST.ADMISSION.DATE)>mdy(\"07/01/2016\"), as.character(mdy(update$LATEST.ADMISSION.DATE)), as.character(mdy(\"07/01/2016\"))) \nupdate$last.date <- \"\"\n\n#3427\n\nfor (i in 2:length(days_list)) {\n  date <- days_list[i-1]\n  update_sub <- subset(update, DOWNLOAD.DATE==date)\n  update_sub_solo <- update_sub[c(\"DOWNLOAD.DATE\", \"IDENTIFIER\", \"first.date\")]\n  \n  date2 <- days_list[i]\n  update_sub2 <- subset(update, DOWNLOAD.DATE==date2)\n  update_sub_solo2 <- update_sub2[c(\"DOWNLOAD.DATE\", \"IDENTIFIER\", \"first.date\")]\n  update_sub_combined <- full_join(update_sub_solo, update_sub_solo2, by=\"IDENTIFIER\")\n\n  update_sub_combined$first.date <- ifelse(is.na(update_sub_combined$DOWNLOAD.DATE.x), as.character(mdy(as.character(update_sub_combined$DOWNLOAD.DATE.y))), as.character(ymd(update_sub_combined$first.date.x)))\n  update_sub_combined$last.date <- ifelse(is.na(update_sub_combined$DOWNLOAD.DATE.y), as.character(mdy(as.character(update_sub_combined$DOWNLOAD.DATE.x))), \"\")\n  \n  update_sub_combined <- update_sub_combined[c(\"IDENTIFIER\",\"first.date\",\"last.date\")]\n  \n  if (i == 2) {\n    update_all <- update_sub_combined\n  } else {\n    update_all <- rbind(update_all, update_sub_combined)\n  }\n  update_all_complete <- update_all[!duplicated(update_all), ]\n  \n}\n\ndupes <- update_all_complete[duplicated(update_all_complete$IDENTIFIER),]\ndupes$dupe <- \"duplicate\"\ndupes <- dupes[c(\"IDENTIFIER\", \"dupe\")]\n\nupdate_all_complete <- left_join(update_all_complete, dupes)\n\nduped <- subset(update_all_complete, dupe==\"duplicate\")\nduped <- arrange(duped, IDENTIFIER)\n\nfor (i in 1:nrow(duped)) {\n  if ((duped$IDENTIFIER[i]== duped$IDENTIFIER[i+1]) & (i !=nrow(duped))) {\n    \n    if (duped$first.date[i] == duped$first.date[i+1]) {\n      duped$last.date[i] <- ifelse(duped$last.date[i]==\"\", duped$last.date[i+1], duped$last.date[i])\n      duped$last.date[i+1] <- ifelse(duped$last.date[i]==\"\", duped$last.date[i+1], duped$last.date[i])\n      \n    }\n    \n    if (duped$first.date[i] > duped$first.date[i+1]) {\n      duped$first.date[i] <- duped$first.date[i+1]\n    }\n    \n    if (duped$first.date[i] < duped$first.date[i+1]) {\n      duped$first.date[i + 1] <- duped$first.date[i]\n    }\n    \n  }\n  \n}\n\nduped <- unique(duped)\n\nupdate_all_complete_final <- subset(update_all_complete, is.na(dupe))\nupdate_all_complete_final <- rbind(update_all_complete_final, duped)\n\nupdate$auth.date <- NULL\nupdate$first.date <- NULL\nupdate$last.date <- NULL\n\nupdate <- left_join(update, update_all_complete_final, by=\"IDENTIFIER\")\nupdate$dupe <- NULL\nupdate$first.date[update$first.date == \"2016-07-01\"] <- NA\nupdate$total.days <- ymd(update$last.date) - ymd(update$first.date)\n\nwrite.csv(table(update$total.days, update$RACE), \"race_days.csv\")\n```\n\n## Median days spent in jail (of those who came and left between July 1 and today\n\n```{r time_table}\nmedian_d <- update %>%\n  group_by(RACE) %>%\n  summarise(Days=median(total.days, na.rm=T))\n\nkable(median_d)\n```\n\n```{r avg_time_table}\navg_d <- update %>%\n  group_by(RACE) %>%\n  summarise(Days=mean(total.days, na.rm=T))\nkable(median_d)\n\nout <- subset(update, !is.na(total.days))\nstill_in <- subset(update, is.na(total.days))\nout_yet <- subset(still_in, last.date==\"\")\nstill_in <- subset(still_in, last.date!=\"\")\n\n\nout2 <- count(out[unique(out$IDENTIFIER),])\nout_yet2 <- count(out_yet[unique(out_yet$IDENTIFIER),])\nstill_in2 <- count(still_in[unique(still_in$IDENTIFIER),])\n```\n\n## Inmate turnover\n\nPre-trial inmates who arrived before July 1 and has since left jail\n* `r out_yet2`\n\nPre-trial inmates who arrived after July 1 and has since left jail\n* `r out2`\n\nPre-trial inmates who are still in jail\n* `r still_in2`\n\n-----\n\n## Inmates still in jail by race\n\n```{r total_inmates1}\ntotal_inmates <- length(unique(update$IDENTIFIER))\n\n\nstill_in_t <- still_in[unique(still_in$IDENTIFIER),] %>%\n  group_by(RACE) %>%\n  summarise(count=n())\n\nkable(still_in_t)\n```\n\n## Inmates still who came in to jail and have left\n\n```{r in_out}\n\nout_t <- out[unique(out$IDENTIFIER),] %>%\n  group_by(RACE) %>%\n  summarise(count=n())\n\nkable(out_t)\n\n```\n\n## Inmates who came in before July 1 and have since left\n\n```{r out_yet}\nout_yet_t <- out_yet[unique(out_yet$IDENTIFIER),] %>%\n  group_by(RACE) %>%\n  summarise(count=n())\n\nkable(out_yet_t)\n```",
    "created" : 1470840977122.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2197594392",
    "id" : "E4B4DA0A",
    "lastKnownWriteTime" : 1470842221,
    "last_content_update" : 1470842221939,
    "path" : "~/Documents/Github/data/2016/07/pre-trial-inmates-ct/index.Rmd",
    "project_path" : "index.Rmd",
    "properties" : {
        "source_window_id" : "",
        "tempName" : "Untitled1"
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}
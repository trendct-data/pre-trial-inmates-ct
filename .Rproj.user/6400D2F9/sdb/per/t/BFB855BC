{
    "collab_server" : "",
    "contents" : "# First Day\n# Last Day\n# Length of stay\nlibrary(dplyr)\nlibrary(lubridate)\n\nupdate <- read.csv(\"https://data.ct.gov/api/views/b674-jy6w/rows.csv\")\n\n\ndays_list <- unique(update$DOWNLOAD.DATE)\nupdate$auth.date <- mdy(update$DOWNLOAD.DATE)\nupdate$first.date <- ifelse(mdy(update$LATEST.ADMISSION.DATE)>mdy(\"07/01/2016\"), as.character(mdy(update$LATEST.ADMISSION.DATE)), as.character(mdy(\"07/01/2016\"))) \nupdate$last.date <- \"\"\n\n#3427\n\nfor (i in 2:length(days_list)) {\n  date <- days_list[i-1]\n  update_sub <- subset(update, DOWNLOAD.DATE==date)\n  update_sub_solo <- update_sub[c(\"DOWNLOAD.DATE\", \"IDENTIFIER\", \"first.date\")]\n  \n  date2 <- days_list[i]\n  update_sub2 <- subset(update, DOWNLOAD.DATE==date2)\n  update_sub_solo2 <- update_sub2[c(\"DOWNLOAD.DATE\", \"IDENTIFIER\", \"first.date\")]\n  update_sub_combined <- full_join(update_sub_solo, update_sub_solo2, by=\"IDENTIFIER\")\n\n  update_sub_combined$first.date <- ifelse(is.na(update_sub_combined$DOWNLOAD.DATE.x), as.character(mdy(as.character(update_sub_combined$DOWNLOAD.DATE.y))), as.character(ymd(update_sub_combined$first.date.x)))\n  update_sub_combined$last.date <- ifelse(is.na(update_sub_combined$DOWNLOAD.DATE.y), as.character(mdy(as.character(update_sub_combined$DOWNLOAD.DATE.x))), \"\")\n  \n  update_sub_combined <- update_sub_combined[c(\"IDENTIFIER\",\"first.date\",\"last.date\")]\n  \n  if (i == 2) {\n    update_all <- update_sub_combined\n  } else {\n    update_all <- rbind(update_all, update_sub_combined)\n  }\n  update_all_complete <- update_all[!duplicated(update_all), ]\n  \n}\n\ndupes <- update_all_complete[duplicated(update_all_complete$IDENTIFIER),]\ndupes$dupe <- \"duplicate\"\ndupes <- dupes[c(\"IDENTIFIER\", \"dupe\")]\n\nupdate_all_complete <- left_join(update_all_complete, dupes)\n\nduped <- subset(update_all_complete, dupe==\"duplicate\")\nduped <- arrange(duped, IDENTIFIER)\n\nfor (i in 1:nrow(duped)) {\n  if ((duped$IDENTIFIER[i]== duped$IDENTIFIER[i+1]) & (i !=nrow(duped))) {\n    \n    if (duped$first.date[i] == duped$first.date[i+1]) {\n      duped$last.date[i] <- ifelse(duped$last.date[i]==\"\", duped$last.date[i+1], duped$last.date[i])\n      duped$last.date[i+1] <- ifelse(duped$last.date[i]==\"\", duped$last.date[i+1], duped$last.date[i])\n      \n    }\n    \n    if (duped$first.date[i] > duped$first.date[i+1]) {\n      duped$first.date[i] <- duped$first.date[i+1]\n    }\n    \n    if (duped$first.date[i] < duped$first.date[i+1]) {\n      duped$first.date[i + 1] <- duped$first.date[i]\n    }\n    \n  }\n  \n}\n\nduped <- unique(duped)\n\nupdate_all_complete_final <- subset(update_all_complete, is.na(dupe))\nupdate_all_complete_final <- rbind(update_all_complete_final, duped)\n\nupdate$auth.date <- NULL\nupdate$first.date <- NULL\nupdate$last.date <- NULL\n\nupdate <- left_join(update, update_all_complete_final, by=\"IDENTIFIER\")\nupdate$dupe <- NULL\nupdate$first.date[update$first.date == \"2016-07-01\"] <- NA\nupdate$total.days <- ymd(update$last.date) - ymd(update$first.date)\n\nwrite.csv(table(update$total.days, update$RACE), \"race_days.csv\")\ntapply(update$total.days, update$RACE, median, na.rm=T)\ntapply(update$total.days, update$RACE, mean, na.rm=T)\n\nout <- subset(update, !is.na(total.days))\nstill_in <- subset(update, is.na(total.days))\nout_yet <- subset(still_in, last.date==\"\")\nstill_in <- subset(still_in, last.date!=\"\")\n\n\nout2 <- count(out[unique(out$IDENTIFIER),])\nout_yet2 <- count(out_yet[unique(out_yet$IDENTIFIER),])\nstill_in2 <- count(still_in[unique(still_in$IDENTIFIER),])\n\ntotal_inmates <- length(unique(update$IDENTIFIER))\n\nstill_in[unique(still_in$IDENTIFIER),] %>%\n  group_by(RACE) %>%\n  summarise(count=n())\n\nout[unique(out$IDENTIFIER),] %>%\n  group_by(RACE) %>%\n  summarise(count=n())\n\nout_yet[unique(out_yet$IDENTIFIER),] %>%\n  group_by(RACE) %>%\n  summarise(count=n())\n\ncat(\"total: \")\n",
    "created" : 1469015582393.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1600700025",
    "id" : "BFB855BC",
    "lastKnownWriteTime" : 1470540516,
    "last_content_update" : 1470540516,
    "path" : "~/Documents/Github/data/2016/07/pre-trial-inmates-ct/time_in_jail.R",
    "project_path" : "time_in_jail.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}